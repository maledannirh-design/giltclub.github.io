<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GILT Club</title>

<style>
body{
margin:0;
font-family: Arial, Helvetica, sans-serif;
background:#F2E8D5;
color:#2E5D3A;
}

/* HEADER */
.header{
position:fixed;
top:0;
left:0;
right:0;
height:70px;
background:white;
display:flex;
align-items:center;
justify-content:space-between;
padding:0 12px;
box-shadow:0 2px 10px rgba(0,0,0,0.08);
z-index:999;
}

.logo{
height:50px;
}

.menu{
display:flex;
gap:12px;
}

.menu a{
font-size:13px;
}


/* GENERAL */
section{
padding-top:110px;
display:flex;
align-items:center;
justify-content:center;
text-align:center;
flex-direction:column;
}

/* HERO */
.hero{
height:33vh;
padding:20px;
}

/* ===== MOBILE PRODUCT CAROUSEL ===== */

.store{
height:auto;
background:#fff;
padding-bottom:30px;
}

.slider{
display:flex;
overflow-x:auto;
scroll-snap-type:x mandatory;
-webkit-overflow-scrolling:touch;
gap:0;
padding:20px 0;
}

.slider::-webkit-scrollbar{
display:none;
}

.card{
flex:0 0 100%;
max-width:100%;
scroll-snap-align:center;
box-sizing:border-box;
padding:20px;
background:#F2E8D5;
margin:0;
border-radius:0;
}

.card img{
width:220px;
height:220px;
object-fit:contain;
border-radius:16px;
margin:auto;
display:block;
}


/* MEMBER */
.member{
background:#E5A9A9;
color:white;
padding:40px 20px;
}

.member img{
width:160px;
height:200px;
border-radius:20px;
object-fit:contain;
background:white;
margin-bottom:15px;
}

.button{
background:#2E5D3A;
color:white;
padding:12px 20px;
border-radius:12px;
margin-top:10px;
display:inline-block;
text-decoration:none;
}

  /* SCHEDULE */
.schedule{
margin-top:15px;
width:100%;
}

.calendar{
display:flex;
justify-content:space-between;
gap:6px;
padding:10px;
}

.day{
background:white;
padding:8px;
border-radius:10px;
font-size:12px;
width:100%;
}

.today{
background:#2E5D3A;
color:white;
font-weight:bold;
}

.mabarBox{
background:white;
margin:12px;
padding:15px;
border-radius:14px;
box-shadow:0 4px 12px rgba(0,0,0,0.1);
}

.joinBtn{
margin-top:10px;
background:#2E5D3A;
color:white;
border:none;
padding:12px 20px;
border-radius:12px;
font-weight:bold;
}
.schedule{
display:grid;
grid-template-columns:repeat(2,1fr);
gap:10px;
padding:15px;
}

.dayBox{
background:white;
border-radius:14px;
padding:10px;
position:relative;
box-shadow:0 3px 10px rgba(0,0,0,0.1);
text-align:left;
}

.date{
position:absolute;
top:8px;
right:10px;
background:#2E5D3A;
color:white;
padding:4px 8px;
border-radius:8px;
font-size:12px;
}

.dayName{
font-weight:bold;
margin-bottom:6px;
}

.dayContent{
font-size:12px;
}

</style>
</head>

<body>

<!-- LOGIN POPUP -->
<div id="loginBox" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;z-index:9999;">
  <div style="background:white;padding:25px;border-radius:18px;width:280px;text-align:center">
    <h3>Member Login</h3>
    <input id="loginUser" placeholder="Username" style="width:90%;padding:10px;margin:6px;border-radius:8px;border:1px solid #ccc">
    <input id="loginPin" type="password" placeholder="PIN" style="width:90%;padding:10px;margin:6px;border-radius:8px;border:1px solid #ccc">
    <br><br>
    <button onclick="doLogin()" style="background:#2E5D3A;color:white;padding:10px 18px;border:none;border-radius:10px">Login</button>
    <br><br>
    <a href="#" onclick="closeLogin()">Tutup</a>
    <p id="loginMsg" style="color:red"></p>
  </div>
</div>

<!-- HEADER -->
<div class="header">
<img src="images/club_product/logo_giltclub.png" class="logo">
<div class="menu">
<a href="#">Daftar</a>
<a href="#" onclick="openLogin()">Login Member</a>
<a href="#">VIP Login</a>
</div>
</div>

<!-- HERO -->
<section class="hero">
<h1>WELCOME TO GILT CLUB</h1>
<p>Tennis Sport & Social Community</p>
  <div class="schedule" id="scheduleBox"></div>
  <div class="schedule">

  <div class="calendar">
    <div class="day">MON<br><small>3</small></div>
    <div class="day">TUE<br><small>4</small></div>
    <div class="day today">WED<br><small>5</small></div>
    <div class="day">THU<br><small>6</small></div>
    <div class="day">FRI<br><small>7</small></div>
    <div class="day">SAT<br><small>8</small></div>
    <div class="day">SUN<br><small>9</small></div>
  </div>

  <div class="mabarBox">
    <b>Jadwal Mabar</b><br>
    10 - 12 Orang<br>
    Rp100.000 / member<br>
    <span style="color:#2E5D3A;font-weight:bold">Member: Rp75.000</span>

    <br><br>
    <button class="joinBtn">JOIN</button>
  </div>

</div>

</section>

<!-- STORE -->
<section class="store">
<h2>Product on Sale (Diskon Gede)</h2>
<div class="slider" id="productSlider"></div>
</section>

<!-- MEMBER -->
<section class="member">
<h2>Meet Our Member</h2>
<img id="memberFoto">
<h3 id="memberNama"></h3>
<p id="memberDesk"></p>
<a class="button">Terhubung dengan Member</a>
</section>

<script>

const API="https://script.google.com/macros/s/AKfycbxotHCtZmg_ovBM_ZCkS-M2TLWIa9-GzPv0CBNt5iu0NXejQIQ9gfElBtCBafZPrjKkeg/exec";

/* MEMBERS */

let members=[];
let index=0;

async function loadMembers(){
 const res=await fetch(API+"?action=members");
 const text=await res.text();
 members=JSON.parse(text);
 tampilMember();
 setInterval(tampilMember,5000);
}

function tampilMember(){
 if(!members.length)return;
 const m=members[index];
 document.getElementById("memberFoto").src="images/members/"+m.username+".png";
 document.getElementById("memberNama").innerText=m.name;
 document.getElementById("memberDesk").innerText=m.bio;
 index=(index+1)%members.length;
}

/* PRODUCTS */

let sliderInterval;

async function loadProducts(){
 const res=await fetch(API+"?action=products");
 const text=await res.text();
 const products=JSON.parse(text);

 const slider=document.getElementById("productSlider");
 slider.innerHTML="";

 products.forEach(p=>{
  const foto="images/club_product/"+p.id+".png";
  const qty=Number(p.qty);

  let status="";
  if(qty<=0) status="<div style='color:red'>Habis</div>";
  else if(qty<=3) status="<div style='color:orange'>Sisa "+qty+"</div>";
  else status="<div style='color:green'>Tersedia</div>";

  let hargaHTML="";
  if(Number(p.disc)>0){
    hargaHTML=`<div style="text-decoration:line-through">Rp ${p.price}</div>
               <div style="color:red;font-weight:bold">Rp ${p.dprice}</div>
               <div style="background:#2E5D3A;color:white;border-radius:8px;padding:3px 8px;display:inline-block">-${p.disc}%</div>`;
  }else{
    hargaHTML=`<div style="font-weight:bold">Rp ${p.price}</div>`;
  }

  slider.innerHTML+=`
  <div class="card">
    <img src="${foto}">
    <div><b>${p.name}</b></div>
    <div style="font-size:12px">${p.desc}</div>
    ${hargaHTML}
    ${status}
    <br>
    <button onclick="beliProduk('${p.id}')" style="background:#2E5D3A;color:white;border:none;padding:8px 14px;border-radius:10px;margin-top:8px">Beli</button>
  </div>`;
 });

/* ===== TUNGGU GAMBAR SELESAI LOAD ===== */

const images = slider.querySelectorAll("img");
let loaded = 0;

images.forEach(img=>{
  if(img.complete){
    loaded++;
  }else{
    img.onload = ()=>{
      loaded++;
      if(loaded === images.length){
        startSlider();
      }
    }
  }
});

// kalau semua sudah cache
if(loaded === images.length){
  startSlider();
}

  
function startSlider(){

  clearInterval(sliderInterval);

  sliderInterval = setInterval(()=>{

    const cardWidth = slider.clientWidth;
    slider.scrollBy({
      left: cardWidth,
      behavior: "smooth"
    });

    // kalau sudah terakhir â†’ balik ke awal
    if(slider.scrollLeft + slider.clientWidth >= slider.scrollWidth - 5){
      setTimeout(()=>{
        slider.scrollTo({left:0, behavior:"smooth"});
      },800);
    }

  },5000);
}


/* LOGIN */

function openLogin(){document.getElementById("loginBox").style.display="flex";}
function closeLogin(){document.getElementById("loginBox").style.display="none";}

async function doLogin(){
 const username=encodeURIComponent(document.getElementById("loginUser").value.trim());
 const pin=encodeURIComponent(document.getElementById("loginPin").value.trim());

 const res=await fetch(API+`?action=login&username=${username}&pin=${pin}`);
 const text=await res.text();
 const data=JSON.parse(text);

 if(data.status==="ok"){
  localStorage.setItem("giltUser",username);
  closeLogin();
  alert("Login berhasil!\nSilahkan isi saldo minimal untuk melanjutkan transaksi.");
 }else{
  document.getElementById("loginMsg").innerText="Username / PIN salah";
 }
}

function beliProduk(id){
 if(!localStorage.getItem("giltUser")){
   alert("Login member dulu ya");
   openLogin();
   return;
 }
 alert("Pembelian akan terhubung ke G-Wallet (tahap berikutnya)");
}

loadMembers();
loadProducts();


  /* ===== SCHEDULE ===== */

async function loadSchedule(){

 const res = await fetch(API+"?action=schedule");
 const days = await res.json();

 const box=document.getElementById("scheduleBox");
 box.innerHTML="";

 const namaHari=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];

 days.forEach((d,i)=>{

  let isi="Tidak ada";

  if(d.max>0){
    isi=`Mabar Club<br>
    ${d.jam}<br>
    ${d.max} org<br>
    100k / member<br>
    <b>Member 75k</b>`;
  }

  box.innerHTML+=`
  <div class="dayBox">
    <div class="date">${d.tanggal}</div>
    <div class="dayName">${namaHari[i]}</div>
    <div class="dayContent">${isi}</div>
  </div>`;
 });

}

loadSchedule();

</script>
</body>
</html>
